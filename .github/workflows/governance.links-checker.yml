name: governane.link-checker

# Run action on pull request event
on:
  push:
    branches:
      - master  # Set a branch to deploy
  pull_request:
    types: [opened, edited]
  schedule:
  - cron: "0 9 * * *"
  workflow_dispatch:

jobs:
  markdown-link-check:
    runs-on: ubuntu-latest
    steps:
    # checkout to latest commit
    - uses: actions/checkout@master
      with:
        fetch-depth: 1
    # run markdown linter
    - uses: gaurav-nelson/github-action-markdown-link-check@v1
    # todo https://github.com/peter-evans/link-checker
    - name: link checker
      uses: lycheeverse/lychee-action@v1.0.6
      if: failure()
      id: lychee

    - name: results
      id: results
      run: |
        cat ./lychee/out.md

    - name: Fail if there were link errors
      run: exit ${{ steps.lychee.outputs.exit_code }}
